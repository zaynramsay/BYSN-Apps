---
import { APPS } from '@/lib/constants';

interface Props {
  links?: Array<{ label: string; href: string }>;
}

const { links = [
  { label: 'Features', href: '#features' },
  { label: 'How It Works', href: '#how-it-works' },
  { label: 'Privacy', href: '#privacy' },
] } = Astro.props;
---

<nav class="cake-nav fixed top-0 left-0 right-0 z-50 transition-all duration-500">
  <div class="max-w-[1200px] mx-auto px-6 py-4 flex items-center justify-between">
    <!-- Logo -->
    <a href="/apps/cake" class="flex items-center gap-3 group">
      <img
        src="/assets/cakeLogo.png"
        alt="Cake"
        class="w-9 h-9 rounded-xl transition-transform duration-300 group-hover:scale-110"
      />
      <span class="text-white font-bold text-lg tracking-tight">Cake</span>
    </a>

    <!-- Nav Links (desktop) -->
    <div class="hidden md:flex items-center gap-8">
      {links.map((link) => (
        <a
          href={link.href}
          class="text-text-body text-sm font-medium tracking-tight transition-colors duration-300 hover:text-white"
        >
          {link.label}
        </a>
      ))}
    </div>

    <!-- CTA Button -->
    <a
      href={APPS.cake.appStoreUrl}
      target="_blank"
      rel="noopener noreferrer"
      class="bg-brand text-white px-5 py-2.5 rounded-full text-sm font-semibold tracking-tight transition-all duration-300 hover:brightness-110 hover:shadow-brand active:scale-95"
    >
      Download
    </a>
  </div>
</nav>

<!-- Mobile menu button (hamburger) -->
<button class="cake-mobile-menu-btn fixed top-4 right-20 z-50 md:hidden w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10 backdrop-blur-md" aria-label="Menu">
  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
  </svg>
</button>

<!-- Mobile menu overlay -->
<div class="cake-mobile-menu fixed inset-0 z-[60] hidden">
  <div class="absolute inset-0 bg-black/90 backdrop-blur-xl" />
  <div class="relative z-10 flex flex-col items-center justify-center h-full gap-8">
    <button class="cake-mobile-menu-close absolute top-6 right-6 w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 border border-white/10" aria-label="Close">
      <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    {links.map((link) => (
      <a
        href={link.href}
        class="cake-mobile-link text-white text-2xl font-bold tracking-tight transition-colors duration-300 hover:text-brand"
      >
        {link.label}
      </a>
    ))}
    <a
      href={APPS.cake.appStoreUrl}
      target="_blank"
      rel="noopener noreferrer"
      class="mt-4 bg-brand text-white px-8 py-3 rounded-full text-lg font-semibold tracking-tight transition-all duration-300 hover:brightness-110"
    >
      Download
    </a>
  </div>
</div>

<script>
  function initNavbar() {
    const nav = document.querySelector('.cake-nav');
    const menuBtn = document.querySelector('.cake-mobile-menu-btn');
    const menu = document.querySelector('.cake-mobile-menu');
    const closeBtn = document.querySelector('.cake-mobile-menu-close');
    const mobileLinks = document.querySelectorAll('.cake-mobile-link');

    if (!nav) return;

    function onScroll() {
      if (window.scrollY > 50) {
        nav.classList.add('nav-scrolled-cake');
      } else {
        nav.classList.remove('nav-scrolled-cake');
      }
    }

    function openMenu() {
      menu?.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      menu?.classList.add('hidden');
      document.body.style.overflow = '';
    }

    menuBtn?.addEventListener('click', openMenu);
    closeBtn?.addEventListener('click', closeMenu);
    mobileLinks.forEach(link => link.addEventListener('click', closeMenu));

    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initNavbar);
  } else {
    initNavbar();
  }
</script>

<style>
  .cake-nav {
    backdrop-filter: blur(0px);
    -webkit-backdrop-filter: blur(0px);
  }

  .cake-nav.nav-scrolled-cake {
    background: rgba(11, 11, 11, 0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  }
</style>
